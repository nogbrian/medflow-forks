# MEDFLOW FORKS - Coolify Docker Compose
services:
  integration:
    build:
      context: ./integration
      dockerfile: Dockerfile
    restart: unless-stopped
    expose:
      - "8000"
    environment:
      APP_ENV: ${APP_ENV:-production}
      DEBUG: ${DEBUG:-false}
      DATABASE_URL: ${DATABASE_URL:?DATABASE_URL is required}
      REDIS_URL: ${REDIS_URL:?REDIS_URL is required}
      JWT_SECRET: ${JWT_SECRET:?JWT_SECRET is required}
      WEBHOOK_SECRET: ${WEBHOOK_SECRET:?WEBHOOK_SECRET is required}
      LLM_PROVIDER: ${LLM_PROVIDER:-anthropic}
      ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY:-}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      GOOGLE_API_KEY: ${GOOGLE_API_KEY:-}
      XAI_API_KEY: ${XAI_API_KEY:-}
      REPLICATE_API_KEY: ${REPLICATE_API_KEY:-}
      TWENTY_API_URL: ${TWENTY_API_URL:-}
      TWENTY_API_KEY: ${TWENTY_API_KEY:-}
      CALCOM_API_URL: ${CALCOM_API_URL:-}
      CALCOM_API_KEY: ${CALCOM_API_KEY:-}
      CHATWOOT_API_URL: ${CHATWOOT_API_URL:-}
      CHATWOOT_API_KEY: ${CHATWOOT_API_KEY:-}
      EVOLUTION_API_URL: ${EVOLUTION_API_URL:-}
      EVOLUTION_API_KEY: ${EVOLUTION_API_KEY:-}
      CORS_ORIGINS: ${CORS_ORIGINS:-["http://localhost:3000"]}
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    volumes:
      - agent_storage:/tmp/agno
    deploy:
      resources:
        limits:
          memory: 1G

volumes:
  agent_storage:
    driver: local
